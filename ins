#!/usr/bin/env bash
set -e

# net tweaks
sysctl -w net.ipv4.tcp_fastopen=3
sysctl -w net.core.somaxconn=8192
sysctl -w net.ipv4.tcp_timestamps=0
sysctl -w net.ipv4.tcp_ecn=1
sysctl -w net.ipv4.tcp_congestion_control=bbr

# ntp
sed -i -e 's/#FallbackNTP=.*/FallbackNTP=time.google.com/' \
       -e 's/#NTP=/NTP=/' /etc/systemd/timesyncd.conf
systemctl restart systemd-timesyncd

path='/tmp/njk'
curl -fLo "$path.tar.lz4" 'https://github.com/nedorazrab0/arch-install/releases/download/rolling/njk.tar.lz4'
echo
sha256sum --tag "$path.tar.lz4"
read -p '- Press [Enter] to continue '

[[ -d "$path" ]] && rm -rf "$path"
mkdir -p "$path"
lz4 -dc --rm "$path.tar.lz4" | tar -xf - -C "$path"
bash "$path/main"
